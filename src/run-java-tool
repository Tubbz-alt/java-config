#!/bin/bash

if [[ -n ${GENTOO_VM} ]]; then
	vmpath=/usr/lib/jvm/${GENTOO_VM}/
elif [[ -h ${HOME}/.gentoo/java-config-2/current-user-vm ]]; then
	vmpath=${HOME}/.gentoo/java-config-2/current-user-vm/
else
	vmpath=/etc/java-config-2/current-system-vm/
fi
tool=$(basename $0)
bin=${vmpath}/bin/${tool}
jrebin=${vmpath}/jre/bin/${tool}

if [[ -x ${bin} ]]; then 
	exec ${bin} "${@}"
elif [[ -x ${jrebin} ]]; then
	exec ${jrebin} "${@}"
else
	if [[ ! -d ${vmpath} ]]; then
		echo "Could not find: ${vmpath}" >&2
		echo "Wrong system/user vm or GENTOO_VM" >&2
	else
		echo "Want too run ${vmpath}/{,jre}/bin/${tool} but it does not exist or is not executable" >&2
		echo "Broken vm install" >&2
	fi
	exit 1
fi


